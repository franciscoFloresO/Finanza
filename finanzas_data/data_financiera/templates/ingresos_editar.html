{% extends 'base.html' %}

{% block title %}
{{ division }} - {{ pais }} - {{ tipo_data }} - {{ anno }} - {{ mes }}
{% endblock %}

{% block content %}
{% load custom_filter %}
<br>
<div style="justify-items: center;">
    <h2>Ingresos Editables</h2>
    <h3 style="justify-self: center;">{{ division }} - {{ pais }} - {{ tipo_data }} - {{ anno }} - {{ mes }}</h3>  
</div>
<br>
<form method="post" action="{% url 'ingresos_editar' %}?division={{ division }}&pais={{ pais }}&tipo_data={{ tipo_data }}&annos={{ anno }}&mes={{ mes }}">
    {% csrf_token %}

    <input type="hidden" name="pais_seleccionado" value="{{ pais }}">
    <div class="mb-3">
        <table class="table table-hover table-striped">
            <thead>
                <tr>
                    <th scope="col">Servicio</th>
                    <th scope="col">Centro Costo</th>
                    <th scope="col">Pais</th>
                    <th scope="col">Divisi√≥n</th>
                    <th scope="col">Forecast</th>
                    <th scope="col">Real</th>
                    <th scope="col">ID</th>
                </tr> 
            </thead>
            <tbody>
                {% for ingreso in ingresos %}
                <tr>
                    <td scope="row">{{ ingreso.ingreso_cliente }}</td>
                    <td>{{ ingreso.ingreso_ceco }}</td>
                    <td>{{ ingreso.ingreso_pais }}</td>
                    <td>{{ ingreso.ingreso_division }}</td>
                    <td>
                        {% if ingreso.ingreso_forecast %}
                            {{ ingreso.ingreso_forecast }}
                        {% else %}
                            {% for clientes in cliente %}
                                <input type="number" name="ingreso_forecast_{{ ingreso.id_ingreso }}">
                            {% endfor %}
                        {% endif %}
                    </td>
                    <td><input type="number" name="ingreso_real_{{ ingreso.id_ingreso }}" value="{{ ingreso.ingreso_real }}"></td>
                    <td>{{ ingreso.id_ingreso }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tbody>
                {% for cliente in cliente %}
                    {% with ingreso=ingresos|get_by_cliente:cliente.cliente_nombre %}
                        {% if not ingreso %}
                            <tr>
                                <td scope="row">{{ cliente.cliente_nombre }}</td>
                                <td>{{ cliente.cliente_ceco }}</td>
                                <td>{{ cliente.cliente_pais }}</td>
                                <td>{{ cliente.cliente_division }}</td>
                                <td><input type="number" name="ingreso_forecast_{{ cliente.id }}" placeholder="Nuevo forecast"></td>
                                <td><input type="number" name="ingreso_real_{{ cliente.id }}" placeholder="Nuevo valor real"></td>
                                <td>N/A</td>
                            </tr>
                        {% endif %}
                    {% endwith %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="justify-content-end" style="width: 50%;">
        <button type="submit" class="btn btn-primary justify-content-end">Ingresar</button>
    </div>
</form>
{% endblock %}